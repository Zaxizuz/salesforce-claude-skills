---
name: salesforce-orchestrator
description: Orchestration agent for Salesforce development that coordinates between salesforce-apex, salesforce-qa, and external Salesforce Vibe agent. Use when managing end-to-end Salesforce development workflows that require code generation, best practice validation, and quality assurance across multiple agents.
---

# Salesforce Development Orchestrator

This skill orchestrates complex Salesforce development workflows by coordinating multiple specialized agents to ensure high-quality, production-ready code.

## Orchestration Workflow

When managing a complete Salesforce development task, follow this workflow:

```
1. ANALYZE REQUEST
   ↓
2. PLAN APPROACH (identify which agents needed)
   ↓
3. SALESFORCE VIBE (initial code generation)
   ↓
4. SALESFORCE-APEX (review & enhance with best practices)
   ↓
5. SALESFORCE-QA (comprehensive quality review)
   ↓
6. ITERATE (if issues found, cycle back through agents)
   ↓
7. FINALIZE (deliver production-ready code)
```

## Core Principles

### Multi-Agent Coordination
- **Leverage strengths**: Use each agent for what it does best
- **Sequential refinement**: Each agent improves upon previous work
- **Feedback loops**: Iterate based on QA findings
- **Context preservation**: Maintain requirements throughout pipeline

### Quality Gates
Code must pass through these quality gates:
1. **Functional correctness** (Salesforce Vibe)
2. **Best practices** (salesforce-apex)
3. **Quality assurance** (salesforce-qa)
4. **Final validation** (orchestrator review)

## Workflow Details

### Step 1: Analyze Request

Extract and clarify:
- **Objective**: What needs to be built?
- **Scope**: Triggers, classes, tests, LWCs?
- **Data model**: Which objects and fields?
- **Business logic**: What are the rules?
- **Integration points**: Any external systems?
- **Success criteria**: How to validate completion?

**Questions to ask user if unclear:**
- "What should trigger this functionality?"
- "Which objects will be affected?"
- "Are there any specific governor limit concerns?"
- "What error handling is expected?"
- "Do you have existing code to enhance or building from scratch?"

### Step 2: Plan Approach

Determine agent involvement:

**Scenario A: New Development**
```
User Request → Salesforce Vibe (generate) → Apex Agent (optimize) → QA Agent (validate) → Deliver
```

**Scenario B: Enhancement/Refactoring**
```
User Request → Apex Agent (analyze + enhance) → QA Agent (validate) → Deliver
```

**Scenario C: Code Review Only**
```
User Request → QA Agent (review) → Apex Agent (fix issues) → QA Agent (re-validate) → Deliver
```

**Scenario D: Complex Integration**
```
User Request → Salesforce Vibe (integration scaffold) → Apex Agent (security + error handling) → QA Agent (validate) → Load testing recommendations → Deliver
```

### Step 3: Salesforce Vibe Consultation

**When to use Salesforce Vibe:**
- Need Salesforce-specific code generation
- Require org-aware context (metadata, existing code)
- Want AI assistance with Salesforce platform nuances
- Building on existing Salesforce patterns

**What to request from Vibe:**
- Initial code structure and implementation
- Salesforce metadata (objects, fields, relationships)
- Platform-specific patterns (triggers, batch jobs, etc.)
- Integration scaffolding

**What to provide to Vibe:**
- Clear requirements and acceptance criteria
- Object and field names
- Business rules and logic
- Any existing code for reference

**Example Vibe request:**
```
"Generate an Account trigger handler that:
1. Updates related Opportunities when Account Status changes
2. Prevents deletion if Account has Closed Won Opportunities
3. Sends email notification to Account Owner on status change
4. Includes comprehensive test class with 100% coverage"
```

### Step 4: Salesforce-Apex Enhancement

**Purpose**: Enhance Vibe-generated (or existing) code with best practices

**Review focus:**
1. **Bulkification**: Ensure all code handles collections properly
2. **Governor limits**: Validate no SOQL/DML in loops
3. **Architecture**: Apply proper patterns (handler, service, selector)
4. **Error handling**: Add try-catch, logging, rollback
5. **Security**: Implement CRUD/FLS checks, sharing rules
6. **Performance**: Optimize queries, use maps for lookups
7. **Async patterns**: Add batch/queueable if needed

**Apex agent instructions:**
```
"Review this code generated by Salesforce Vibe and enhance it with:
1. Proper trigger handler pattern
2. Bulkification for all operations
3. Comprehensive error handling
4. Security checks (CRUD/FLS)
5. Optimized SOQL queries
6. Detailed inline comments
7. Ensure test class has meaningful assertions and bulk testing

Original code:
[paste Vibe code]

Requirements:
[paste requirements]
"
```

### Step 5: Salesforce-QA Validation

**Purpose**: Comprehensive quality assurance review

**QA agent instructions:**
```
"Perform comprehensive QA review on this Salesforce code:

[paste enhanced code]

Verify:
1. All critical issues resolved (SOQL/DML in loops)
2. Test coverage ≥ 90% with meaningful assertions
3. Security practices followed
4. Error handling comprehensive
5. Performance optimized
6. Code meets org standards
7. Documentation adequate

Provide detailed review report with:
- Critical/Major/Minor issues categorized
- Specific recommendations for each issue
- Overall approval status
- Code coverage metrics
"
```

**QA outcomes:**
- **APPROVED**: Deploy to production
- **APPROVED WITH CHANGES**: Minor improvements suggested
- **REJECTED**: Critical issues must be fixed (return to Step 4)

### Step 6: Iteration Loop

If QA identifies issues:

```
MINOR ISSUES → Quick fixes → Re-validate → Approve
MAJOR ISSUES → Apex agent refactor → QA re-review → Iterate
CRITICAL ISSUES → Re-design approach → Start from Step 3 → Full pipeline
```

**Iteration example:**
```
QA finds: "SOQL query in loop on line 45"
↓
Return to Apex agent: "Fix critical governor limit issue - SOQL in loop"
↓
Apex agent refactors with bulkified approach
↓
Return to QA agent for re-validation
↓
Approved → Proceed to finalization
```

### Step 7: Finalization

**Delivery checklist:**
- [ ] All code files organized properly
- [ ] Test classes included with ≥90% coverage
- [ ] Documentation provided (README)
- [ ] Deployment guide included
- [ ] Known limitations documented
- [ ] QA review report attached

**Delivery format:**
```markdown
# Salesforce Development Delivery

## Overview
[Brief description of what was built]

## Components Delivered
- **Apex Classes**: [list]
- **Triggers**: [list]
- **Test Classes**: [list]
- **LWCs**: [list if applicable]

## Code Quality Metrics
- **Test Coverage**: [X%]
- **QA Status**: [APPROVED]
- **Code Review**: [Passed]

## Installation Instructions
1. [Step by step deployment guide]

## Testing Instructions
1. [How to validate the functionality]

## Known Limitations
- [Any constraints or future considerations]

## Files
[Provide download links or file contents]
```

## Agent Communication Patterns

### Requesting Code from Salesforce Vibe

**Clear request format:**
```
Context: [What you're building and why]
Requirements:
1. [Specific requirement]
2. [Specific requirement]
Objects: [Account, Opportunity, etc.]
Fields: [Custom fields to use]
Expected behavior: [Step by step]
```

### Sending to Apex Agent for Enhancement

**Enhancement request format:**
```
Task: Enhance this code with Salesforce best practices

Original code:
[code from Vibe]

Specific focuses:
- Bulkification
- Error handling
- Security
- Test quality
- [other specific concerns]
```

### Sending to QA Agent for Review

**QA request format:**
```
Task: Comprehensive QA review

Code under review:
[enhanced code]

Original requirements:
[requirements]

Priority concerns:
- [specific areas to focus on]
```

## Error Recovery

**If Salesforce Vibe fails:**
- Fallback to Apex agent for manual implementation
- Provide detailed requirements and pseudocode
- Reference similar patterns in org

**If Apex enhancement fails:**
- Break down into smaller components
- Focus on one pattern at a time (e.g., just bulkification first)
- Provide specific examples of desired patterns

**If QA repeatedly fails code:**
- Simplify the approach
- Consider alternative architecture
- Escalate complexity concerns to user

## Best Practices for Orchestration

### Communication
- Maintain clear context between agent interactions
- Document decision rationale
- Preserve all requirements throughout pipeline
- Share relevant portions of previous agent outputs

### Efficiency
- Don't over-iterate on minor issues
- Batch multiple related changes together
- Recognize when "good enough" is achieved
- Know when to escalate to user for decisions

### Quality Control
- Never skip QA review, even for "simple" changes
- Validate that each agent actually improved the code
- Ensure test coverage requirements are met
- Check that original requirements are still satisfied

## Example: Complete Orchestration

**User Request:**
"Build a trigger that prevents Account deletion if it has related Opportunities with Amount > $100K"

**Orchestrator Process:**

**Step 1: Analyze**
- Objective: Prevent deletion based on business rule
- Scope: Account trigger, handler, test class
- Logic: Check related Opportunities, sum Amount, block if > $100K

**Step 2: Plan**
- Use Salesforce Vibe for initial generation
- Apex agent for best practices
- QA agent for validation

**Step 3: Request from Vibe**
```
"Generate an Account before delete trigger that:
1. Queries related Opportunities
2. Sums the Amount field
3. Prevents deletion if total > $100,000
4. Shows user-friendly error message
5. Includes test class with edge cases"
```

**Step 4: Send to Apex Agent**
```
"Enhance this Vibe-generated code:

[paste code]

Focus on:
- Bulkification (handle multiple Accounts)
- Efficient SOQL (avoid N+1 queries)
- Proper trigger handler pattern
- Test class with bulk testing (200 records)
- Error handling
"
```

**Step 5: Send to QA Agent**
```
"Review this deletion prevention trigger:

[paste enhanced code]

Verify:
- Bulk-safe for 200 Accounts
- No SOQL in loops
- Test coverage > 90%
- Edge cases tested (zero Opps, null Amounts, etc.)
"
```

**Step 6: QA Result**
```
QA Status: APPROVED WITH CHANGES
- Minor: Add test case for deleted Opportunities
- Suggestion: Consider future enhancement for other criteria
```

**Step 7: Final Enhancement**
- Add suggested test case
- Document future enhancement possibility
- Prepare delivery package

**Delivery:**
- AccountTrigger.trigger
- AccountTriggerHandler.cls
- AccountTriggerHandlerTest.cls (95% coverage)
- README.md with deployment instructions
- QA approval report

## Summary

The orchestrator ensures:
1. ✅ Requirements fully understood
2. ✅ Right agents used for each task
3. ✅ Code passes all quality gates
4. ✅ Issues caught and fixed before delivery
5. ✅ Production-ready, maintainable code

By coordinating Salesforce Vibe, apex agent, and QA agent effectively, complex Salesforce development becomes systematic, reliable, and high-quality.
